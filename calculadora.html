<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora de Viagens Premium</title>
  <style>
    :root{ --bg:#f6f7fb; --card:#ffffff; --accent:#0f6cf2; --muted:#6b7280; --glass: rgba(15,108,242,0.08); }
    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#f2f6ff 0%,#f6f7fb 100%);color:#0b1220}
    .wrap{max-width:960px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;gap:16px;margin-bottom:12px}
    header h1{font-size:20px;margin:0}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:16px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(12,18,40,0.06)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text],input[type=number],select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px}
    .row{display:flex;gap:12px}
    .row > *{flex:1}
    .small{max-width:160px}
    .btn{background:var(--accent);color:white;padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .mutebtn{background:transparent;border:1px solid #e6e9ef;padding:8px;border-radius:10px;cursor:pointer}
    .results{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
    .metric{background:var(--glass);padding:10px;border-radius:10px}
    .metric b{display:block;font-size:18px}
    .indicator{padding:8px;border-radius:8px;font-weight:700;margin-top:8px;text-align:center}
    .good{background:#e6fbef;color:#056e3a}
    .bad{background:#fff0f0;color:#9b1c1c}
    .compare{margin-top:8px}
    small{color:var(--muted)}
    .history{max-height:320px;overflow:auto;margin-top:8px}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:6px;border-bottom:1px solid #eef1f6;text-align:left}
    th{font-weight:700;color:#0b1220}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    footer{margin-top:14px;text-align:center;color:var(--muted);font-size:13px}
    @media(max-width:880px){.grid{grid-template-columns:1fr}.small{max-width:none}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='42' height='42'><rect rx='10' width='42' height='42' fill='%230f6cf2'/><text x='50%' y='55%' font-size='20' fill='white' font-family='Arial' text-anchor='middle' dominant-baseline='middle'>ƒ</text></svg>" alt="logo" style="width:42px;height:42px;border-radius:10px;"/>
      <div>
        <h1>Calculadora de Viagens Premium</h1>
        <small>Decida rápido — calcule custo real, lucro e compare plataformas</small>
      </div>
    </header>

    <div class="grid">
      <!-- Left: Inputs & Results -->
      <div>
        <div class="card">
          <h3>Dados do veículo & custos</h3>
          <div style="margin-top:8px">
            <label>Preço do combustível (R$/L)</label>
            <input id="precoComb" type="number" step="0.01" value="4.99" />
          </div>
          <div style="margin-top:8px" class="row">
            <div>
              <label>Consumo médio (km/L)</label>
              <input id="consumo" type="number" step="0.1" value="10" />
            </div>
            <div>
              <label>Km rodados por dia (média)</label>
              <input id="kmDia" type="number" step="1" value="200" />
            </div>
          </div>

          <div style="margin-top:8px" class="row">
            <div>
              <label>Custo variável (R$/km) — óleo, pneus, manutenção</label>
              <input id="custoVarKm" type="number" step="0.01" value="0.15" />
            </div>
            <div>
              <label>Depreciação estimada (R$/dia)</label>
              <input id="depreciacao" type="number" step="0.1" value="10" />
            </div>
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid #eef1f6"/>

          <h3>Dados da corrida</h3>
          <div class="row" style="margin-top:8px">
            <div>
              <label>Distância até passageiro (km)</label>
              <input id="kmIda" type="number" step="0.1" value="1.2" />
            </div>
            <div>
              <label>Distância da corrida (km)</label>
              <input id="kmViagem" type="number" step="0.1" value="10" />
            </div>
          </div>

          <div class="row" style="margin-top:8px">
            <div>
              <label>Tempo estimado (min)</label>
              <input id="tempoMin" type="number" step="1" value="25" />
            </div>
            <div>
              <label>Valor recebido (R$)</label>
              <input id="valorRecebido" type="number" step="0.01" value="28.50" />
            </div>
          </div>

          <div style="margin-top:8px">
            <label>Taxas/plataformas (em %)</label>
            <div class="row">
              <input id="taxUber" type="number" step="0.1" value="25" />
              <input id="tax99" type="number" step="0.1" value="24" />
              <input id="taxIndriver" type="number" step="0.1" value="10" />
            </div>
            <div style="display:flex;gap:10px;margin-top:8px">
              <button class="btn" id="calcBtn">CALCULAR VIAGEM PREMIUM</button>
              <button class="mutebtn" id="limparBtn">Limpar histórico</button>
            </div>
          </div>

          <div class="results" id="resultArea" aria-live="polite" style="margin-top:12px">
            <div class="metric">
              <small>Custo real por km</small>
              <b id="cck">R$ 0,00</b>
            </div>
            <div class="metric">
              <small>Lucro líquido previsto</small>
              <b id="lucro">R$ 0,00</b>
              <div id="indAccept" class="indicator" style="display:none"></div>
            </div>

            <div class="metric">
              <small>Ganho bruto (corrida)</small>
              <b id="ganhoBruto">R$ 0,00</b>
            </div>
            <div class="metric">
              <small>Custo operacional (corrida)</small>
              <b id="custoOp">R$ 0,00</b>
            </div>
          </div>

          <div class="card" style="margin-top:12px">
            <small>Comparativo entre plataformas</small>
            <div id="comparativos" class="compare"></div>
          </div>

        </div>

        <div class="card" style="margin-top:12px">
          <h3>Exportar / Relatório</h3>
          <p style="margin:6px 0;color:var(--muted)">Gere um resumo da avaliação atual ou baixe o histórico.</p>
          <div class="actions">
            <button class="btn" id="exportPdf">Gerar relatório (imprimir)</button>
            <button class="mutebtn" id="exportCsv">Baixar histórico CSV</button>
            <button class="mutebtn" id="exportJson">Baixar histórico JSON</button>
          </div>
        </div>

      </div>

      <!-- Right: Summary & History -->
      <div>
        <div class="card">
          <h3>Resumo rápido</h3>
          <p style="margin:6px 0;color:var(--muted)">Indicadores baseados nos inputs — ideal para decisão instantânea.</p>
          <div style="margin-top:10px">
            <div class="metric"><small>Meta diária (R$)</small><b id="metaDiaria">R$ 200,00</b></div>
          </div>

          <div style="margin-top:12px">
            <label>Meta diária (R$)</label>
            <input id="metaInput" type="number" step="1" value="200" />
          </div>

          <div style="margin-top:12px">
            <h4>Histórico de viagens avaliadas (Premium)</h4>
            <div class="history card" id="historyBox">
              <table id="historyTable">
                <thead><tr><th>Hora</th><th>Km</th><th>Lucro</th><th>Plataforma</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
            <small style="display:block;margin-top:6px;color:var(--muted)">As avaliações ficam salvas localmente no dispositivo.</small>
          </div>

        </div>

        <div class="card" style="margin-top:12px">
          <h4>Dicas rápidas</h4>
          <ul style="margin:6px 0 0 18px;color:var(--muted)">
            <li>Prefira corridas com lucro líquido >= 20% da sua média.</li>
            <li>Evite longas idas sem passageiro (km de deslocamento alto).</li>
            <li>Use o histórico para identificar horários mais lucrativos.</li>
          </ul>
        </div>

      </div>
    </div>

    <footer>
      Versão Premium — Personalize com suas taxas. Dados salvos localmente.
    </footer>
  </div>

  <script>
    // Helpers
    const $ = id => document.getElementById(id);
    const format = v => (typeof v === 'number' ? 'R$ ' + v.toFixed(2) : v);

    // Load history from localStorage
    const HISTORY_KEY = 'calc_premium_history_v1';
    function loadHistory(){
      try{ return JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]'); }catch(e){return []}
    }
    function saveHistory(h){ localStorage.setItem(HISTORY_KEY, JSON.stringify(h)); }

    function renderHistory(){
      const tbody = document.querySelector('#historyTable tbody'); tbody.innerHTML='';
      const hist = loadHistory();
      hist.slice().reverse().forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${new Date(item.t).toLocaleString()}</td><td>${(item.km || 0).toFixed(1)}</td><td>${format(item.lucro)}</td><td>${item.platform || ''}</td>`;
        tbody.appendChild(tr);
      });
    }

    function calcAndRender(){
      // read inputs
      const precoComb = parseFloat($('precoComb').value) || 0;
      const consumo = parseFloat($('consumo').value) || 1;
      const kmDia = parseFloat($('kmDia').value) || 0;
      const custoVarKm = parseFloat($('custoVarKm').value) || 0;
      const depreciacao = parseFloat($('depreciacao').value) || 0;

      const kmIda = parseFloat($('kmIda').value) || 0;
      const kmViagem = parseFloat($('kmViagem').value) || 0;
      const tempoMin = parseFloat($('tempoMin').value) || 0;
      const valorRecebido = parseFloat($('valorRecebido').value) || 0;

      const taxUber = parseFloat($('taxUber').value) || 0;
      const tax99 = parseFloat($('tax99').value) || 0;
      const taxIndriver = parseFloat($('taxIndriver').value) || 0;

      // Custo combustível por km
      const custoCombKm = precoComb / consumo; // R$/km
      // Custo operacional por km (comb + variáveis)
      const custoOpKm = custoCombKm + custoVarKm;
      // Custo do deslocamento (ida + viagem) em km
      const kmTotal = +(kmIda + kmViagem);
      // Custo operacional total da corrida
      const custoOpCorrida = custoOpKm * kmTotal + (depreciacao / Math.max(1, kmDia)) * kmTotal; // aproximação

      // Taxas (ex.: aplicar sobre ganho bruto)
      const taxaUberVal = valorRecebido * (taxUber/100);
      const taxa99Val = valorRecebido * (tax99/100);
      const taxaIndriverVal = valorRecebido * (taxIndriver/100);

      // Lucro líquido por plataforma
      const lucroUber = valorRecebido - custoOpCorrida - taxaUberVal;
      const lucro99 = valorRecebido - custoOpCorrida - taxa99Val;
      const lucroIndriver = valorRecebido - custoOpCorrida - taxaIndriverVal;

      // Custo real por km (considerando custo operacional apenas nesta corrida)
      const cckReal = custoOpCorrida / (kmTotal || 1);

      // Determine recommendation
      const lucroEscolhido = Math.max(lucroUber, lucro99, lucroIndriver);
      const platform = lucroEscolhido === lucroUber ? 'Uber' : (lucroEscolhido === lucro99 ? '99' : 'InDriver');

      const lucroPercent = (lucroEscolhido / Math.max(0.0001, valorRecebido)) * 100;

      // Meta
      const meta = parseFloat($('metaInput').value) || 0;

      // Update UI
      $('cck').textContent = format(cckReal);
      $('ganhoBruto').textContent = format(valorRecebido);
      $('custoOp').textContent = format(custoOpCorrida);
      $('lucro').textContent = format(lucroEscolhido);

      const ind = $('indAccept');
      ind.style.display = 'block';
      if(lucroPercent >= 15){ ind.className = 'indicator good'; ind.textContent = 'ACEITE — lucro ≈ ' + lucroPercent.toFixed(0) + '%'; }
      else { ind.className = 'indicator bad'; ind.textContent = 'NÃO VALE A PENA — lucro ≈ ' + lucroPercent.toFixed(0) + '%'; }

      // Comparativos
      const comp = $('comparativos'); comp.innerHTML = '';
      const comps = [
        {name:'Uber', taxa:taxUberVal, lucro:lucroUber},
        {name:'99', taxa:tax99Val, lucro:lucro99},
        {name:'InDriver', taxa:taxaIndriverVal, lucro:lucroIndriver}
      ];
      comps.forEach(c => {
        const el = document.createElement('div');
        el.style.padding='8px 0';
        el.innerHTML = `<b>${c.name}</b> — Lucro: ${format(c.lucro)} <small style='margin-left:8px;color:var(--muted)'>Taxa: ${format(c.taxa)}</small>`;
        comp.appendChild(el);
      });

      // Save to history
      const hist = loadHistory();
      hist.push({t:Date.now(), km:kmTotal, lucro: +(lucroEscolhido||0).toFixed(2), platform, inputs:{precoComb,consumo,kmIda,kmViagem,valorRecebido}});
      // keep last 500
      while(hist.length>500) hist.shift();
      saveHistory(hist);
      renderHistory();

      return {cckReal, custoOpCorrida, lucroEscolhido, platform, lucroPercent};
    }

    // Events
    $('calcBtn').addEventListener('click', () => { calcAndRender(); });

    // Export functions
    $('exportPdf').addEventListener('click', ()=>{
      // build simple printable layout
      const res = calcAndRender();
      const html = `
        <html><head><meta charset='utf-8'><title>Relatório de Viagem</title>
        <style>body{font-family:Arial;padding:20px}h2{color:#0f6cf2}</style></head><body>
        <h2>Relatório: Avaliação de Viagem</h2>
        <p>Hora: ${new Date().toLocaleString()}</p>
        <ul>
          <li>Custo real por km: ${format(res.cckReal)}</li>
          <li>Custo operacional total: ${format(res.custoOpCorrida || 0)}</li>
          <li>Lucro previsto: ${format(res.lucroEscolhido || 0)}</li>
          <li>Plataforma recomendada: ${res.platform}</li>
        </ul>
        <p>Gerado por Calculadora Premium.</p>
        </body></html>`;
      const w = window.open('','_blank');
      w.document.write(html); w.document.close();
      w.print();
    });

    $('exportCsv').addEventListener('click', ()=>{
      const hist = loadHistory();
      const rows = ['hora,km,lucro,plataforma'];
      hist.forEach(h=> rows.push(`${new Date(h.t).toISOString()},${h.km},${h.lucro},${h.platform || ''}`));
      const blob = new Blob([rows.join('\n')],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'historico_viagens.csv'; a.click(); URL.revokeObjectURL(url);
    });

    $('exportJson').addEventListener('click', ()=>{
      const hist = loadHistory();
      const blob = new Blob([JSON.stringify(hist, null, 2)],{type:'application/json'});
      const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'historico_viagens.json'; a.click(); URL.revokeObjectURL(url);
    });

    $('limparBtn').addEventListener('click', ()=>{ if(confirm('Limpar todo o histórico?')){ localStorage.removeItem(HISTORY_KEY); renderHistory(); }});

    // Initialize
    renderHistory();
  </script>
</body>
</html>

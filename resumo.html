<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Resumo - Motorista App</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
:root{
    --bg: #ffffff;
    --page-gap: #f3f5f8;

    --card: #fafbfc;
    --card-strong: #f0f2f5;
    --panel: #ffffff;

    --brand: #0b5bd7;
    --brand-dark: #073f8a;

    --accent-success: #1DB954;
    --accent-danger: #ff3b30;

    --text: #0b1115;
    --muted: #65707a;

    --shadow: 0 6px 16px rgba(13,30,45,0.07);
    --shadow-strong: 0 10px 32px rgba(10,20,30,0.12);

    --radius: 14px;
    --menu-bg: linear-gradient(135deg,var(--brand),var(--brand-dark));
    --menu-text: #fff;
}

.dark{
    --bg: #0f1115;
    --page-gap: #15171c;

    --card: #181a20;
    --card-strong: #1d1f27;
    --panel: #1b1d25;

    --text: #e5e7eb;
    --muted: #9ca3af;

    --shadow: 0 6px 16px rgba(0,0,0,0.35);
    --shadow-strong: 0 10px 32px rgba(0,0,0,0.45);

    --brand: #3b82f6;
    --brand-dark: #2563eb;

    --accent-success: #22c55e;
    --accent-danger: #ef4444;

    --menu-bg: linear-gradient(135deg,var(--brand),var(--brand-dark));
}

*{ box-sizing:border-box; font-family: Inter, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

body{
    margin:0;
    background:linear-gradient(180deg, var(--page-gap), var(--bg) 50%);
    color:var(--text);
    padding-bottom:160px;
    -webkit-font-smoothing:antialiased;
}

/* header */
header{
    padding:18px 16px;
    max-width:980px;
    margin:0 auto 10px auto;
    display:flex;
    align-items:center;
    justify-content:space-between;
}
.brand{ display:flex; align-items:center; gap:12px; }
.brand .logo{
    width:46px;height:46px;border-radius:12px;display:flex;align-items:center;justify-content:center;
    font-weight:800;color:#fff;background:linear-gradient(135deg,var(--brand),var(--brand-dark));
    box-shadow:var(--shadow);font-size:18px;
}
#toggleTheme{ background:var(--card-strong); padding:8px 12px; border-radius:10px; border:1px solid rgba(0,0,0,0.08); cursor:pointer; color:var(--text); font-weight:700; }

/* container */
.container{ max-width:980px; margin:20px auto; padding:0 16px; }

/* top cards */
.top-row{ display:flex; gap:16px; flex-wrap:wrap; justify-content:space-between; }
.cardTop{ flex:1; min-width:150px; background:var(--card); padding:18px; border-radius:var(--radius); box-shadow:var(--shadow); border:1px solid #d7dce2; }
.cardTop h3{ margin:0; font-size:13px; color:var(--muted); font-weight:700; }
.cardTop .value{ margin-top:8px; font-size:26px; font-weight:800; color:var(--text); }

/* filters */
.filters{ display:flex; gap:10px; margin-top:18px; }
.filters button{ flex:1; padding:12px; border-radius:12px; border:1px solid transparent; background:var(--card); cursor:pointer; font-weight:700; color:var(--text); box-shadow:var(--shadow); }
.filters button.active{ background:linear-gradient(135deg,var(--brand),var(--brand-dark)); color:#fff; border:none; }

/* cards */
.card{ margin-top:18px; background:var(--card); padding:18px; border-radius:var(--radius); box-shadow:var(--shadow); border:1px solid #d7dce2; }
.card h2{ margin:0 0 12px 0; font-size:18px; color:var(--text); font-weight:800; }

/* lines */
.line{ display:flex; justify-content:space-between; padding:12px 0; border-bottom:1px solid rgba(0,0,0,0.05); color:var(--text); font-size:15px; }
.hint{ font-size:13px; color:var(--muted); }

/* chart area (vertical bars style, compact) */
.chartRow{ display:flex; gap:12px; align-items:end; padding-top:10px; }
.chartCard{ flex:1; min-width:100px; background:var(--card-strong); padding:12px; border-radius:12px; display:flex; flex-direction:column; align-items:center; gap:8px; border:1px solid #e6eaef; }
.barShell{ width:48px; height:140px; background:var(--panel); border-radius:12px; display:flex; align-items:flex-end; justify-content:center; overflow:hidden; border:1px solid rgba(0,0,0,0.03); }
.barInner{ width:100%; display:flex; align-items:flex-end; justify-content:center; color:#fff; font-weight:800; border-radius:10px 10px 0 0; }

/* === NOVO BOTTOM MENU - MODERNO === */
.neo-menu{
  backdrop-filter: blur(10px);
  background: rgba(10,20,35,0.55);
  border:1px solid rgba(255,255,255,0.1);
  border-radius:18px;
  padding:12px 0;
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  width:92%;
  max-width:980px;
  display:flex;
  justify-content:space-around;
  box-shadow:0 18px 40px rgba(0,0,0,0.35);
  z-index:2000;
}

.neo-menu .menu-item{
  text-decoration:none;
  color:#fff;
  font-weight:700;
  font-size:12px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:3px;
  opacity:.75;
  transition:.25s;
}

.neo-menu .menu-item .icon{ font-size:20px; }

.neo-menu .menu-item.active{
  opacity:1;
  transform:scale(1.15);
}

body.dark .neo-menu{
  background: rgba(25,25,30,0.65);
  border-color:rgba(255,255,255,0.05);
}
</style>
</head>
<body>

<header>
    <div class="brand">
        <div class="logo">RF</div>
        <h2 style="margin:0;">Resumo</h2>
    </div>

    <button id="toggleTheme">üåô</button>
</header>

<div class="container">

    <!-- Top cards -->
    <div class="top-row">
        <div class="cardTop">
            <h3>Faturamento</h3>
            <div id="valFaturamento" class="value">R$ 0,00</div>
        </div>

        <div class="cardTop">
            <h3>Despesas</h3>
            <div id="valDespesas" class="value">R$ 0,00</div>
        </div>

        <div class="cardTop">
            <h3>Lucro L√≠quido</h3>
            <div id="valLucro" class="value">R$ 0,00</div>
        </div>
    </div>

    <!-- Filters -->
    <div class="filters">
        <button id="fDia" class="active" onclick="setFiltro('dia')">Hoje</button>
        <button id="fSemana" onclick="setFiltro('semana')">Semana</button>
        <button id="fMes" onclick="setFiltro('mes')">M√™s</button>
    </div>

    <!-- Resumo por m√©todo -->
    <div class="card">
        <h2>Resumo por M√©todo</h2>
        <div class="line"><span>Dinheiro:</span> <strong id="mDinheiro">R$ 0,00</strong></div>
        <div class="line"><span>PIX:</span> <strong id="mPix">R$ 0,00</strong></div>
        <div class="line"><span>Cart√£o:</span> <strong id="mCartao">R$ 0,00</strong></div>
        <div class="line"><span>App (Uber/99):</span> <strong id="mApp">R$ 0,00</strong></div>
        <div class="line"><span>Outras entradas:</span> <strong id="mOutras">R$ 0,00</strong></div>
    </div>

    <!-- Resumo por categoria -->
    <div class="card">
        <h2>Resumo por Categoria</h2>
        <div class="line"><span>Uber:</span> <strong id="cUber">R$ 0,00</strong></div>
        <div class="line"><span>99:</span> <strong id="c99">R$ 0,00</strong></div>
        <div class="line"><span>InDriver:</span> <strong id="cInDriver">R$ 0,00</strong></div>
        <div class="line"><span>Particular:</span> <strong id="cParticular">R$ 0,00</strong></div>
        <div class="line"><span>Empresa:</span> <strong id="cEmpresa">R$ 0,00</strong></div>
    </div>

    <!-- Chart (vertical bars, compact) -->
    <div class="card">
        <h2>Desempenho</h2>
        <div class="chartRow" style="margin-top:8px;">
            <div class="chartCard">
                <div class="barShell" aria-hidden="true">
                    <div id="barFat" class="barInner" style="height:10%; background:var(--brand);"></div>
                </div>
                <div class="hint">Faturamento</div>
                <div id="barFatLabel" class="hint">0%</div>
            </div>

            <div class="chartCard">
                <div class="barShell" aria-hidden="true">
                    <div id="barDesp" class="barInner" style="height:10%; background:var(--accent-danger);"></div>
                </div>
                <div class="hint">Despesas</div>
                <div id="barDespLabel" class="hint">0%</div>
            </div>

            <div class="chartCard">
                <div class="barShell" aria-hidden="true">
                    <div id="barLucro" class="barInner" style="height:10%; background:var(--accent-success);"></div>
                </div>
                <div class="hint">Lucro</div>
                <div id="barLucroLabel" class="hint">0%</div>
            </div>
        </div>
    </div>

</div> <!-- container -->

<!-- =============== MENU INFERIOR ================= -->
<nav class="neo-menu">
  <a href="planos.html" class="menu-item">
    <span class="icon">‚≠ê</span><span>Planos</span>
  </a>
  <a href="index.html" class="menu-item">
    <span class="icon">üè†</span><span>Dashboard</span>
  </a>
  <a href="entradas.html" class="menu-item">
    <span class="icon">üíµ</span><span>Entradas</span>
  </a>
  <a href="recibo_empresa.html" class="menu-item">
    <span class="icon">üè¢</span><span>Empresa</span>
  </a>
  <a href="recibo_particular.html" class="menu-item">
    <span class="icon">üöó</span><span>Particular</span>
  </a>
  <a href="manutencao.html" class="menu-item">
    <span class="icon">üõ†</span><span>Manut.</span>
  </a>
  <a href="resumo.html" class="menu-item active">
    <span class="icon">üìä</span><span>Resumo</span>
  </a>
  <a href="perfil.html" class="menu-item">
    <span class="icon">üë§</span><span>Perfil</span>
  </a>
  <a href="calculadora.html" class="menu-item">
    <span class="icon">üìü</span><span>Calc</span>
  </a>
</nav>

<script src="planos.js"></script>

<script>
if(!planoTem("resumo")){
   alert("Dispon√≠vel somente no plano PRO.");
   location.href="planos.html";
}
</script>

<script>
/* helpers */
const $ = id => document.getElementById(id);
const brl = v => Number(v || 0).toLocaleString("pt-BR", { style: "currency", currency: "BRL" });

/* THEME (sync with other pages) */
function applyTheme(theme){
    if(theme === 'dark'){
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme','dark');
        $('toggleTheme').innerText = '‚òÄÔ∏è';
    } else {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme','light');
        $('toggleTheme').innerText = 'üåô';
    }
}
(function initTheme(){
    const saved = localStorage.getItem('theme') || 'light';
    applyTheme(saved);
    $('toggleTheme').addEventListener('click', ()=>{ const isDark = document.documentElement.classList.contains('dark'); applyTheme(isDark ? 'light' : 'dark'); });
})();

/* Date filters */
let filtro = 'dia';
function setFiltro(f){
    filtro = f;
    document.querySelectorAll('.filters button').forEach(b=>b.classList.remove('active'));
    const id = 'f' + f.charAt(0).toUpperCase() + f.slice(1);
    const el = document.getElementById(id);
    if(el) el.classList.add('active');
    atualizarResumo();
}

/* period helpers */
function isToday(date){
    const n = new Date();
    return date.getFullYear() === n.getFullYear() && date.getMonth() === n.getMonth() && date.getDate() === n.getDate();
}
function isSameWeek(date){
    const now = new Date();
    const start = new Date(now);
    start.setDate(now.getDate() - now.getDay() + 1);
    start.setHours(0,0,0,0);
    const end = new Date(start);
    end.setDate(start.getDate() + 6);
    end.setHours(23,59,59,999);
    return date >= start && date <= end;
}
function isSameMonth(date){
    const now = new Date();
    return date.getFullYear() === now.getFullYear() && date.getMonth() === now.getMonth();
}
function filtrarData(d){
    if(filtro === 'dia') return isToday(d);
    if(filtro === 'semana') return isSameWeek(d);
    return isSameMonth(d);
}

/* main summary calc */
function atualizarResumo(){
    const registros = JSON.parse(localStorage.getItem('entradasSaidas') || '[]');

    let fat = 0, desp = 0;
    let mDin = 0, mPix = 0, mCar = 0, mApp = 0, mOut = 0;
    let cU = 0, c99 = 0, cInd = 0, cPar = 0, cEmp = 0;

    registros.forEach(r=>{
        const d = new Date(r.criadoEm || r.createdAt || Date.now());
        if(!filtrarData(d)) return;
        const v = Number(r.valor || r.valorBruto || 0);

        if(r.tipo === 'entrada'){
            fat += v;

            if(r.formaPag === 'dinheiro') mDin += v;
            else if(r.formaPag === 'pix') mPix += v;
            else if(r.formaPag === 'cartao') mCar += v;
            else if(r.formaPag === 'appMobile') mApp += v;
            else mOut += v;

            if(r.appTipo === 'uber') cU += v;
            if(r.appTipo === '99') c99 += v;
            if(r.appTipo === 'indriver') cInd += v;
            if(r.categoria === 'particular') cPar += v;
            if(r.categoria === 'empresa') cEmp += v;

        } else {
            desp += v;

            if(r.formaPag === 'dinheiro') mDin -= v;
            else if(r.formaPag === 'pix') mPix -= v;
            else if(r.formaPag === 'cartao') mCar -= v;
        }
    });

    const lucro = fat - desp;

    // display values
    $('valFaturamento').innerText = brl(fat);
    $('valDespesas').innerText = brl(desp);
    $('valLucro').innerText = brl(lucro);
    $('valLucro').style.color = lucro >= 0 ? 'var(--accent-success)' : 'var(--accent-danger)';

    $('mDinheiro').innerText = brl(mDin);
    $('mPix').innerText = brl(mPix);
    $('mCartao').innerText = brl(mCar);
    $('mApp').innerText = brl(mApp);
    $('mOutras').innerText = brl(mOut);

    $('cUber').innerText = brl(cU);
    $('c99').innerText = brl(c99);
    $('cInDriver').innerText = brl(cInd);
    $('cParticular').innerText = brl(cPar);
    $('cEmpresa').innerText = brl(cEmp);

    // chart heights (relative)
    const max = Math.max(Math.abs(fat), Math.abs(desp), Math.abs(lucro), 1);
    const pctFat = Math.round(fat / max * 100);
    const pctDesp = Math.round(desp / max * 100);
    const pctLucro = Math.round(Math.abs(lucro) / max * 100);

    const barFat = $('barFat'), barDesp = $('barDesp'), barLucro = $('barLucro');
    if(barFat) { barFat.style.height = Math.max(6, pctFat) + '%'; $('barFatLabel').innerText = pctFat + '%'; }
    if(barDesp) { barDesp.style.height = Math.max(6, pctDesp) + '%'; $('barDespLabel').innerText = pctDesp + '%'; }
    if(barLucro) { barLucro.style.height = Math.max(6, pctLucro) + '%'; $('barLucroLabel').innerText = pctLucro + '%'; }

    // lucro color
    if(barLucro) barLucro.style.background = lucro >= 0 ? 'var(--accent-success)' : 'var(--accent-danger)';
}

/* init */
window.addEventListener('load', ()=> {
    atualizarResumo();

    // ensure bottom menu active item
    document.querySelectorAll('.bottom-menu .menu-item').forEach(el=>{
        el.classList.remove('active');
        const href = el.getAttribute('href') || '';
        if(location.pathname && location.pathname.indexOf(href) !== -1) el.classList.add('active');
        if(!location.pathname && href.includes('resumo.html')) el.classList.add('active');
    });
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Manuten√ß√£o - Motorista App</title>

<!-- Fonte corporativa -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
/* =========================================================
   VARI√ÅVEIS TEMA (CLARO / ESCURO)
   ========================================================= */
:root{
    /* Claro corporativo */
    --bg:#f6f7fb;
    --card:#ffffff;
    --panel:#f1f4f9;
    --text:#0b1115;
    --muted:#768088;
    --brand:#0b5bd7;
    --brand-dark:#073f8a;
    --accent-success:#1DB954;
    --accent-danger:#ff3b30;
    --warning:#f3b22a;
    --shadow:0 6px 20px rgba(15,30,45,0.08);
    --radius:14px;
}

/* Tema escuro global */
.dark{
    --bg:#0e0f11;
    --card:#1a1b1e;
    --panel:#222326;
    --text:#f1f1f1;
    --muted:#889099;
    --shadow:0 6px 26px rgba(0,0,0,0.55);
}

/* =========================================================
   BASE
   ========================================================= */
*{box-sizing:border-box}
body{
    margin:0;
    font-family:'Inter',sans-serif;
    background:var(--bg);
    color:var(--text);
    padding-bottom:140px;
}

/* =========================================================
   HEADER CORPORATIVO
   ========================================================= */
header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:18px 16px;
    max-width:980px;
    margin:0 auto 12px auto;
}

.brand{
    display:flex;
    gap:12px;
    align-items:center;
}

.logo{
    width:42px; height:42px;
    border-radius:10px;
    display:flex; align-items:center; justify-content:center;
    background:linear-gradient(135deg,var(--brand),var(--brand-dark));
    font-weight:800; color:#fff;
    box-shadow:var(--shadow);
}

.brand h1{
    margin:0;
    font-size:17px;
    font-weight:800;
}

/* Bot√£o modo escuro */
#toggleDarkBtn{
    width:44px; height:44px;
    border-radius:12px;
    border:none;
    cursor:pointer;
    font-size:20px;
    background:var(--panel);
    color:var(--text);
    box-shadow:var(--shadow);
}

/* =========================================================
   CONTAINER
   ========================================================= */
.container{
    max-width:980px;
    margin:0 auto;
    padding:0 16px;
}

/* =========================================================
   CARDS
   ========================================================= */
.card{
    background:var(--card);
    padding:18px;
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    margin-bottom:18px;
}

.row{ display:flex; gap:14px; flex-wrap:wrap; }
.col{ flex:1; min-width:260px; }

.label{
    font-size:13px;
    color:var(--muted);
    margin-bottom:6px;
}

input, select{
    width:100%;
    padding:12px 14px;
    border-radius:10px;
    border:1px solid transparent;
    background:var(--panel);
    color:var(--text);
    font-size:15px;
}

input:focus, select:focus{
    outline:none;
    border-color:var(--brand);
}

.btn{
    background:var(--brand);
    color:#fff;
    padding:12px;
    border-radius:12px;
    border:none;
    font-weight:700;
    cursor:pointer;
    width:100%;
    font-size:15px;
}

.btnGhost{
    background:var(--panel);
    color:var(--text);
    padding:10px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:600;
}

.smallNote{
    font-size:13px;
    color:var(--muted);
    margin-top:8px;
}

/* =========================================================
   STATUS BADGES
   ========================================================= */
.badge{
    padding:6px 10px;
    border-radius:10px;
    font-size:13px;
    font-weight:700;
}

.statusGreen{ background:#d7fbe3; color:#0b6620; }
.dark .statusGreen{ background:#114222; color:#9dffc1; }

.statusWarn{ background:#fff4d6; color:#9d6700; }
.dark .statusWarn{ background:#6a4c09; color:#ffeab3; }

.statusRed{ background:#ffe3e3; color:#a00000; }
.dark .statusRed{ background:#5a0a06; color:#ffb3b3; }

/* =========================================================
   LIST ITEM
   ========================================================= */
.listItem{
    background:var(--panel);
    padding:14px;
    border-radius:14px;
    margin-bottom:12px;
    display:flex;
    justify-content:space-between;
    gap:12px;
}

/* =========================================================
   BOTTOM MENU CORPORATIVO
   ========================================================= */
.bottom-menu{
    position:fixed;
    bottom:18px;
    left:50%;
    transform:translateX(-50%);
    width:92%;
    max-width:980px;
    background:linear-gradient(135deg,var(--brand),var(--brand-dark));
    padding:10px 0;
    border-radius:18px;
    display:flex;
    justify-content:space-around;
    box-shadow:0 12px 26px rgba(0,0,0,0.25);
    z-index:999;
}

.bottom-menu .menu-item{
    color:#fff;
    text-decoration:none;
    font-size:13px;
    text-align:center;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:4px;
    font-weight:700;
}

.bottom-menu .menu-item .icon{
    font-size:20px;
}

.bottom-menu .menu-item.active{
    opacity:1;
    transform:scale(1.04);
}

/* RESPONSIVO */
@media(max-width:720px){
    .row{ flex-direction:column; }
}
</style>
</head>

<body>

<header>
    <div class="brand">
        <div class="logo">RF</div>
        <h1>Manuten√ß√£o</h1>
    </div>

    <!-- Toggle modo escuro -->
    <button id="toggleDarkBtn">üåô</button>
</header>

<div class="container">
<!-- =========================================================
     CARD: DADOS DO VE√çCULO / KM ATUAL
     ========================================================= -->
<div class="card">
    <h3 style="margin-top:0; font-size:17px; font-weight:700;">Dados do Ve√≠culo / KM Atual</h3>

    <div class="row">
        <div class="col">
            <div class="label">Nome / Propriet√°rio</div>
            <input id="perfilNome" placeholder="Nome completo">
        </div>

        <div class="col">
            <div class="label">Marca</div>
            <input id="perfilMarca" placeholder="Marca do ve√≠culo">
        </div>

        <div class="col">
            <div class="label">Modelo</div>
            <input id="perfilModelo" placeholder="Modelo do ve√≠culo">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <div class="label">Ano</div>
            <input id="perfilAno" placeholder="Ex: 2018">
        </div>

        <div class="col">
            <div class="label">Placa</div>
            <input id="perfilPlaca" placeholder="Ex: ABC1D23">
        </div>

        <div class="col">
            <div class="label">KM atual (registrar diariamente)</div>
            <input id="kmAtual" type="number" placeholder="Ex: 123456">
        </div>
    </div>

    <div style="display:flex; gap:10px; margin-top:12px;">
        <button id="salvarPerfil" class="btn" style="flex:2;">Salvar dados e atualizar KM</button>
        <button id="limparPerfil" class="btnGhost" style="flex:1;">Recarregar</button>
    </div>

    <div style="display:flex; gap:10px; margin-top:12px;">
        <button id="exportWhats" class="btnGhost" style="flex:1;">Enviar WhatsApp</button>
        <button id="exportPdf" class="btnGhost" style="flex:1;">Gerar PDF</button>
    </div>

    <div class="smallNote">
        Ao salvar o KM atual, todos os registros de manuten√ß√£o ser√£o recalculados automaticamente.
    </div>
</div>

<!-- =========================================================
     CARD: CADASTRAR MANUTEN√á√ÉO / ITEM
     ========================================================= -->
<div class="card">
    <h3 style="margin-top:0; font-size:17px; font-weight:700;">Cadastrar manuten√ß√£o / item</h3>

    <div class="label">Nome da manuten√ß√£o</div>
    <input id="mNome" placeholder="Ex: Troca de √≥leo">

    <div class="row">
        <div class="col">
            <div class="label">KM da √∫ltima troca</div>
            <input id="mKmUltima" type="number" placeholder="Ex: 45000">
        </div>

        <div class="col">
            <div class="label">Intervalo para pr√≥xima troca (km)</div>
            <input id="mIntervalo" type="number" placeholder="Ex: 10000">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <div class="label">Custo estimado da manuten√ß√£o</div>
            <input id="mCusto" type="number" step="0.01" placeholder="R$">
        </div>

        <div class="col">
            <div class="label">Observa√ß√µes (opcional)</div>
            <input id="mObs" placeholder="Ex: usar √≥leo sint√©tico...">
        </div>
    </div>

    <div style="display:flex; gap:10px; margin-top:12px;">
        <button id="addManut" class="btn" style="flex:2;">Adicionar / Salvar manuten√ß√£o</button>
        <button id="limparFormManut" class="btnGhost" style="flex:1;">Limpar</button>
    </div>
</div>

<!-- =========================================================
     CARD: LISTA DE MANUTEN√á√ïES
     ========================================================= -->
<div class="card">
    <h3 style="margin-top:0; font-size:17px; font-weight:700;">Manuten√ß√µes cadastradas</h3>

    <div id="listaManutencoes"></div>

    <div class="smallNote" style="margin-top:14px;">
        ‚Ä¢ Vermelho: ‚â§ 800 km<br>
        ‚Ä¢ Amarelo: ‚â§ 2000 km<br>
        ‚Ä¢ Verde: > 2000 km
    </div>
</div>

<!-- =========================================================
     CARD: HIST√ìRICO DE MANUTEN√á√ïES
     ========================================================= -->
<div class="card">
    <h3 style="margin-top:0; font-size:17px; font-weight:700;">Hist√≥rico de manuten√ß√µes realizadas</h3>

    <table class="table" id="histTable" style="width:100%; margin-top:10px; border-collapse:collapse;">
        <thead>
            <tr>
                <th style="padding:8px; font-size:13px;">Data</th>
                <th style="padding:8px; font-size:13px;">Nome</th>
                <th style="padding:8px; font-size:13px;">KM</th>
                <th style="padding:8px; font-size:13px;">Valor</th>
                <th style="padding:8px; font-size:13px;">Obs</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
<!-- =========================================================
     MENU INFERIOR CORPORATIVO
     ========================================================= -->
<nav class="bottom-menu">
    <a href="index.html" class="menu-item">
        <span class="icon">üè†</span>
        <span>Dashboard</span>
    </a>

    <a href="entradas.html" class="menu-item">
        <span class="icon">üíµ</span>
        <span>Entradas</span>
    </a>

    <a href="manutencao.html" class="menu-item active">
        <span class="icon">üõ†Ô∏è</span>
        <span>Manuten√ß√£o</span>
    </a>

    <a href="resumo.html" class="menu-item">
        <span class="icon">üìä</span>
        <span>Resumo</span>
    </a>

    <a href="perfil.html" class="menu-item">
        <span class="icon">üë§</span>
        <span>Perfil</span>
    </a>

    <a href="calculadora.html" class="menu-item">
        <span class="icon">üìü</span>
        <span>Calc</span>
    </a>
</nav>

<!-- libs for PDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* =========================================================
   TEMA GLOBAL (CLARO / ESCURO) ‚Äî SINCRONIZADO ENTRE P√ÅGINAS
   ========================================================= */
function applyTheme(){
    const theme = localStorage.getItem("themeMode") || "light";
    if(theme === "dark"){
        document.body.classList.add("dark");
        document.getElementById("toggleDarkBtn").textContent = "‚òÄÔ∏è";
    } else {
        document.body.classList.remove("dark");
        document.getElementById("toggleDarkBtn").textContent = "üåô";
    }
}

document.getElementById("toggleDarkBtn").addEventListener("click", () => {
    const theme = document.body.classList.contains("dark") ? "light" : "dark";
    localStorage.setItem("themeMode", theme);
    applyTheme();
});

applyTheme();


/* =========================================================
   STORAGE HELPERS
   ========================================================= */
const $ = id => document.getElementById(id);
const fmt = v => Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
const nowISO = ()=> new Date().toISOString();

function loadPerfil(){ return JSON.parse(localStorage.getItem('perfilMotorista') || '{}'); }
function savePerfil(p){ localStorage.setItem('perfilMotorista', JSON.stringify(p)); }

function loadManuts(){ return JSON.parse(localStorage.getItem('manutencoes') || '[]'); }
function saveManuts(a){ localStorage.setItem('manutencoes', JSON.stringify(a)); }

function loadHist(){ return JSON.parse(localStorage.getItem('manutHistorico') || '[]'); }
function saveHist(a){ localStorage.setItem('manutHistorico', JSON.stringify(a)); }


/* =========================================================
   C√ÅLCULOS DE MANUTEN√á√ÉO
   ========================================================= */
function calcularProximas(m, kmAtual){
    m.kmProxima = Number(m.kmUltimaTroca) + Number(m.intervaloKm);
    m.kmRestante = m.kmProxima - kmAtual;
    m.valorPorKm = (Number(m.custoEstimado)||0) / (Number(m.intervaloKm)||1);
    return m;
}

function colorFromKmRestante(km){
    if(km <= 800) return 'statusRed';
    if(km <= 2000) return 'statusWarn';
    return 'statusGreen';
}


/* =========================================================
   RENDERIZA√á√ÉO DO PERFIL
   ========================================================= */
function renderPerfil(){
    const p = loadPerfil();
    $('perfilNome').value = p.nome || "";
    $('perfilMarca').value = p.carro || "";
    $('perfilModelo').value = p.modelo || "";
    $('perfilAno').value = p.ano || "";
    $('perfilPlaca').value = p.placa || "";
    $('kmAtual').value = p.kmAtual || "";
}


/* =========================================================
   RENDERIZA√á√ÉO DAS MANUTEN√á√ïES
   ========================================================= */
function renderManutencoes(){
    const manuts = loadManuts();
    const perfil = loadPerfil();
    const kmAtual = Number(perfil.kmAtual || 0);

    manuts.forEach(m => calcularProximas(m, kmAtual));
    manuts.sort((a,b) => a.kmRestante - b.kmRestante);
    saveManuts(manuts);

    const box = $('listaManutencoes');
    box.innerHTML = "";

    if(manuts.length === 0){
        box.innerHTML = `<div class="smallNote">Nenhuma manuten√ß√£o cadastrada.</div>`;
        return;
    }

    manuts.forEach(m => {
        const div = document.createElement("div");
        div.className = "listItem";

        const statusClass = colorFromKmRestante(m.kmRestante);
        const txt = m.kmRestante < 0 ? `${Math.abs(m.kmRestante)} km atrasado` : `${m.kmRestante} km restantes`;

        div.innerHTML = `
            <div style="flex:1;">
                <div style="font-weight:700; font-size:15px;">${escape(m.nome)}</div>
                <div class="smallNote">√öltima troca: ${m.kmUltimaTroca} km ‚Ä¢ Pr√≥xima: ${m.kmProxima} km</div>
                <div class="smallNote">Custo estimado: ${fmt(m.custoEstimado)}</div>
                ${m.obs ? `<div class="smallNote">Obs: ${escape(m.obs)}</div>` : ""}
            </div>

            <div style="text-align:right;">
                <div class="badge ${statusClass}">${txt}</div>

                <div style="margin-top:10px; display:flex; flex-direction:column; gap:6px;">
                    <button class="btnGhost" style="font-size:12px;" onclick="editarManut(${m.id})">Editar</button>
                    <button class="btnGhost" style="font-size:12px;" onclick="removerManut(${m.id})">Remover</button>
                    <button class="btn" style="font-size:12px;" onclick="marcarRealizada(${m.id})">Marcar Realizada</button>
                </div>
            </div>
        `;

        box.appendChild(div);
    });
}


/* =========================================================
   RENDERIZA√á√ÉO DO HIST√ìRICO
   ========================================================= */
function renderHistorico(){
    const hist = loadHist();
    const tbody = document.querySelector("#histTable tbody");
    tbody.innerHTML = "";

    if(hist.length === 0){
        tbody.innerHTML = `<tr><td colspan="5" class="smallNote">Nenhum registro ainda.</td></tr>`;
        return;
    }

    hist.slice().reverse().forEach(h => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${new Date(h.data).toLocaleString()}</td>
            <td>${escape(h.nome)}</td>
            <td>${h.kmTroca}</td>
            <td>${fmt(h.custoPago)}</td>
            <td>${escape(h.obs||"")}</td>
        `;
        tbody.appendChild(tr);
    });
}


/* =========================================================
   A√á√ïES
   ========================================================= */
function salvarPerfil(){
    const p = loadPerfil();
    p.nome = $('perfilNome').value.trim();
    p.carro = $('perfilMarca').value.trim();
    p.modelo = $('perfilModelo').value.trim();
    p.ano = $('perfilAno').value.trim();
    p.placa = $('perfilPlaca').value.trim();

    const kmNovo = Number($('kmAtual').value);
    if(kmNovo){ p.kmAtual = kmNovo; }

    savePerfil(p);

    const manuts = loadManuts();
    manuts.forEach(m => calcularProximas(m, kmNovo));
    saveManuts(manuts);

    renderManutencoes();
    alert("Dados salvos e manuten√ß√µes recalculadas!");
}

function limparPerfil(){
    renderPerfil();
    renderManutencoes();
    renderHistorico();
}

function adicionarManut(){
    const nome = $('mNome').value.trim();
    const kmUltima = Number($('mKmUltima').value);
    const intervalo = Number($('mIntervalo').value);
    const custo = Number($('mCusto').value);
    const obs = $('mObs').value.trim();

    if(!nome || !kmUltima || !intervalo){
        alert("Preencha nome, km da √∫ltima troca e intervalo.");
        return;
    }

    const perfil = loadPerfil();
    const kmAtual = Number(perfil.kmAtual || 0);

    const m = {
        id: Date.now(),
        nome,
        kmUltimaTroca: kmUltima,
        intervaloKm: intervalo,
        custoEstimado: custo,
        obs,
        criadoEm: nowISO()
    };

    calcularProximas(m, kmAtual);

    const manuts = loadManuts();
    manuts.push(m);
    saveManuts(manuts);

    renderManutencoes();
    limparFormManut();
}

function editarManut(id){
    const manuts = loadManuts();
    const m = manuts.find(x => x.id === id);
    if(!m) return;

    $('mNome').value = m.nome;
    $('mKmUltima').value = m.kmUltimaTroca;
    $('mIntervalo').value = m.intervaloKm;
    $('mCusto').value = m.custoEstimado;
    $('mObs').value = m.obs;

    removerManut(id);
    window.scrollTo({top:0, behavior:"smooth"});
}

function removerManut(id){
    if(!confirm("Deseja remover esta manuten√ß√£o?")) return;
    const manuts = loadManuts().filter(m => m.id !== id);
    saveManuts(manuts);
    renderManutencoes();
}

function marcarRealizada(id){
    const manuts = loadManuts();
    const m = manuts.find(x => x.id === id);
    if(!m) return;

    const perfil = loadPerfil();
    const kmAtual = Number(perfil.kmAtual || 0);

    const kmTroca = Number(prompt("KM da troca:", kmAtual));
    if(!kmTroca) return;

    const valor = Number(prompt("Valor pago:", m.custoEstimado)) || 0;
    const obs = prompt("Obs:", "") || "";

    const hist = loadHist();
    hist.push({
        id:Date.now(),
        nome:m.nome,
        kmTroca,
        custoPago:valor,
        data:nowISO(),
        obs
    });
    saveHist(hist);

    m.kmUltimaTroca = kmTroca;
    calcularProximas(m, kmAtual);
    saveManuts(manuts);

    if(kmTroca > kmAtual){
        perfil.kmAtual = kmTroca;
        savePerfil(perfil);
        renderPerfil();
    }

    renderManutencoes();
    renderHistorico();
    alert("Manuten√ß√£o registrada!");
}


/* =========================================================
   EXPORTA√á√ÉO (WHATSAPP / PDF)
   ========================================================= */
function exportWhats(){
    const p = loadPerfil();
    const manuts = loadManuts().sort((a,b)=>a.kmRestante-b.kmRestante);

    let msg = `Relat√≥rio de Manuten√ß√£o (${new Date().toLocaleDateString()})\n\n`;
    msg += `Ve√≠culo: ${p.carro||""} ${p.modelo||""} (${p.ano||""})\nPlaca: ${p.placa||""}\nKM Atual: ${p.kmAtual||0}\n\n`;

    manuts.forEach(m => {
        msg += `‚Ä¢ ${m.nome}: Pr√≥xima ${m.kmProxima} km (${m.kmRestante} km restantes)\n`;
    });

    window.open("https://wa.me/?text=" + encodeURIComponent(msg), "_blank");
}

async function exportPdf(){
    const el = document.querySelector(".container");
    const canvas = await html2canvas(el,{scale:1.6});
    const img = canvas.toDataURL("image/png");
    const pdf = new jspdf.jsPDF("p","mm","a4");

    const w = pdf.internal.pageSize.getWidth();
    const h = (canvas.height * w) / canvas.width;

    pdf.addImage(img,"PNG",0,0,w,h);
    pdf.save("manutencao.pdf");
}


/* =========================================================
   UTIL
   ========================================================= */
function escape(s){ return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function limparFormManut(){
    $('mNome').value = "";
    $('mKmUltima').value = "";
    $('mIntervalo').value = "";
    $('mCusto').value = "";
    $('mObs').value = "";
}

/* =========================================================
   BOOT
   ========================================================= */
(function boot(){
    renderPerfil();
    renderManutencoes();
    renderHistorico();
})();
</script>

</body>
</html>

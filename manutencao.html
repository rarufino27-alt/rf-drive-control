<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<title>Manuten√ß√£o - Motorista App</title>

<!-- Fonte corporativa -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<style>
/* =========================================================
   VARI√ÅVEIS TEMA (CLARO / ESCURO)
   ========================================================= */
:root{
    --bg:#f6f7fb;
    --card:#ffffff;
    --panel:#f1f4f9;
    --text:#0b1115;
    --muted:#768088;
    --brand:#0b5bd7;
    --brand-dark:#073f8a;
    --accent-success:#1DB954;
    --accent-danger:#ff3b30;
    --warning:#f3b22a;
    --shadow:0 4px 16px rgba(15,30,45,0.08);
    --radius:14px;
}

/* Tema escuro */
.dark{
    --bg:#0e0f11;
    --card:#1a1b1e;
    --panel:#222326;
    --text:#f1f1f1;
    --muted:#889099;
    --shadow:0 4px 22px rgba(0,0,0,0.6);
}

/* =========================================================
   BASE
   ========================================================= */
*{box-sizing:border-box; font-family:'Inter',sans-serif;}

body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    padding-bottom:140px;
    overflow-x:hidden;
}

/* =========================================================
   HEADER
   ========================================================= */
header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:18px 16px;
    margin:0 auto 10px auto;
    max-width:980px;
}

.brand{
    display:flex;
    align-items:center;
    gap:10px;
}

.logo{
    width:42px;
    height:42px;
    border-radius:10px;
    background:linear-gradient(135deg,var(--brand),var(--brand-dark));
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    font-weight:800;
    font-size:18px;
}

.brand h1{
    margin:0;
    font-size:18px;
    font-weight:800;
}

/* Bot√£o modo escuro */
#toggleDarkBtn{
    width:44px;
    height:44px;
    border:none;
    border-radius:12px;
    font-size:19px;
    background:var(--panel);
    color:var(--text);
    box-shadow:var(--shadow);
    cursor:pointer;
}

/* =========================================================
   CONTAINER
   ========================================================= */
.container{
    max-width:980px;
    margin:0 auto;
    padding:0 16px;
}

/* =========================================================
   CARDS
   ========================================================= */
.card{
    background:var(--card);
    padding:18px;
    border-radius:var(--radius);
    box-shadow:var(--shadow);
    margin-bottom:18px;
}

h3{
    margin:0 0 14px 0;
    font-size:17px;
    font-weight:700;
}

.row{
    display:flex;
    gap:14px;
    flex-wrap:wrap;
}

.col{
    flex:1;
    min-width:160px;
}

.label{
    font-size:13px;
    color:var(--muted);
    margin-bottom:6px;
}

input{
    width:100%;
    padding:12px 14px;
    border-radius:10px;
    border:1px solid transparent;
    background:var(--panel);
    color:var(--text);
    font-size:15px;
}

input:focus{
    border-color:var(--brand);
    outline:none;
}

/* Buttons */
.btn{
    background:var(--brand);
    color:#fff;
    padding:12px;
    border:none;
    width:100%;
    border-radius:12px;
    font-weight:700;
    cursor:pointer;
}

.btnGhost{
    background:var(--panel);
    color:var(--text);
    padding:11px;
    border:none;
    width:100%;
    border-radius:10px;
    font-weight:600;
    cursor:pointer;
}

/* List items */
.listItem{
    background:var(--panel);
    padding:14px;
    border-radius:14px;
    margin-bottom:12px;
    display:flex;
    justify-content:space-between;
    gap:12px;
}

/* Status badges */
.badge{
    padding:6px 10px;
    border-radius:10px;
    font-size:13px;
    font-weight:700;
}

.statusGreen{ background:#d7fbe3; color:#0b6620; }
.statusWarn{ background:#fff4d6; color:#9d6700; }
.statusRed{ background:#ffe3e3; color:#a00000; }

.dark .statusGreen{ background:#114222; color:#9dffc1; }
.dark .statusWarn{ background:#6a4c09; color:#ffeab3; }
.dark .statusRed{ background:#5a0a06; color:#ffb3b3; }

/* Table */
.table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
}

.table th{
    text-align:left;
    padding:8px;
    font-size:12px;
    color:var(--muted);
}

.table td{
    padding:8px;
}

/* Table responsiveness */
.table-wrapper{
    width:100%;
    overflow-x:auto;
}

/* =========================================================
   BOTTOM MENU
   ========================================================= */
.bottom-menu{
    position:fixed;
    bottom:18px;
    left:50%;
    transform:translateX(-50%);
    width:92%;
    max-width:980px;
    background:linear-gradient(135deg,var(--brand),var(--brand-dark));
    padding:10px 0;
    border-radius:18px;
    display:flex;
    justify-content:space-around;
    color:#fff;
    z-index:999;
    box-shadow:0 10px 25px rgba(0,0,0,0.25);
}

.menu-item{
    text-decoration:none;
    text-align:center;
    color:#fff;
    font-size:13px;
    font-weight:700;
    display:flex;
    flex-direction:column;
    gap:4px;
}

.menu-item .icon{
    font-size:20px;
}

.menu-item.active{
    transform:scale(1.05);
}
</style>
</head>
<body>

<header>
    <div class="brand">
        <div class="logo">RF</div>
        <h1>Manuten√ß√£o</h1>
    </div>
    <button id="toggleDarkBtn">üåô</button>
</header>

<div class="container">

<!-- DADOS DO VE√çCULO -->
<div class="card">
    <h3>Dados do Ve√≠culo / KM Atual</h3>

    <div class="row">
        <div class="col">
            <div class="label">Nome / Propriet√°rio</div>
            <input id="perfilNome">
        </div>

        <div class="col">
            <div class="label">Marca</div>
            <input id="perfilMarca">
        </div>

        <div class="col">
            <div class="label">Modelo</div>
            <input id="perfilModelo">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <div class="label">Ano</div>
            <input id="perfilAno">
        </div>

        <div class="col">
            <div class="label">Placa</div>
            <input id="perfilPlaca">
        </div>

        <div class="col">
            <div class="label">KM atual</div>
            <input id="kmAtual" type="number">
        </div>
    </div>

    <div class="row" style="margin-top:10px;">
        <button id="salvarPerfil" class="btn" style="flex:2;">Salvar / Atualizar KM</button>
        <button id="limparPerfil" class="btnGhost" style="flex:1;">Recarregar</button>
    </div>

    <div class="row" style="margin-top:10px;">
        <button id="exportWhats" class="btnGhost">WhatsApp</button>
        <button id="exportPdf" class="btnGhost">PDF</button>
    </div>

</div>

<!-- CADASTRAR MANUTEN√á√ÉO -->
<div class="card">
    <h3>Cadastrar manuten√ß√£o / item</h3>

    <div class="label">Nome</div>
    <input id="mNome">

    <div class="row">
        <div class="col">
            <div class="label">KM √∫ltima troca</div>
            <input id="mKmUltima" type="number">
        </div>

        <div class="col">
            <div class="label">Intervalo (km)</div>
            <input id="mIntervalo" type="number">
        </div>
    </div>

    <div class="row">
        <div class="col">
            <div class="label">Custo estimado</div>
            <input id="mCusto" type="number" step="0.01">
        </div>

        <div class="col">
            <div class="label">Observa√ß√£o</div>
            <input id="mObs">
        </div>
    </div>

    <div class="row" style="margin-top:10px;">
        <button id="addManut" class="btn" style="flex:2;">Adicionar / Salvar</button>
        <button id="limparFormManut" class="btnGhost" style="flex:1;">Limpar</button>
    </div>
</div>

<!-- LISTA -->
<div class="card">
    <h3>Manuten√ß√µes cadastradas</h3>
    <div id="listaManutencoes"></div>
</div>

<!-- HISTORICO -->
<div class="card">
    <h3>Hist√≥rico</h3>
    <div class="table-wrapper">
        <table class="table" id="histTable">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Nome</th>
                    <th>KM</th>
                    <th>Valor</th>
                    <th>Obs</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

</div>

<!-- MENU -->
<nav class="bottom-menu">
    <a href="index.html" class="menu-item"><span class="icon">üè†</span>Dashboard</a>
    <a href="entradas.html" class="menu-item"><span class="icon">üíµ</span>Entradas</a>
    <a href="manutencao.html" class="menu-item active"><span class="icon">üõ†Ô∏è</span>Manuten√ß√£o</a>
    <a href="resumo.html" class="menu-item"><span class="icon">üìä</span>Resumo</a>
    <a href="perfil.html" class="menu-item"><span class="icon">üë§</span>Perfil</a>
    <a href="calculadora.html" class="menu-item"><span class="icon">üìü</span>Calc</a>
</nav>
<script>
/* ===================== THEME ====================== */
function applyTheme(){
    const t = localStorage.getItem("themeMode") || "light";
    if(t === "dark"){
        document.body.classList.add("dark");
        toggleDarkBtn.textContent = "‚òÄÔ∏è";
    } else {
        document.body.classList.remove("dark");
        toggleDarkBtn.textContent = "üåô";
    }
}
toggleDarkBtn.onclick = () => {
    const mode = document.body.classList.contains("dark") ? "light" : "dark";
    localStorage.setItem("themeMode", mode);
    applyTheme();
};
applyTheme();

/* ===================== HELPERS ====================== */
const $ = e => document.getElementById(e);
const currency = v => Number(v||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
const now = () => new Date().toISOString();
const esc = t => t ? t.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])) : "";

/* ===================== STORAGE ====================== */
const load = k => JSON.parse(localStorage.getItem(k) || (k==="manutencoes"?"[]":k==="manutHistorico"?"[]":"{}"));
const save = (k,v) => localStorage.setItem(k, JSON.stringify(v));

/* ===================== PERFIL ====================== */
function renderPerfil(){
    const p = load("perfilMotorista");
    $("perfilNome").value = p.nome || "";
    $("perfilMarca").value = p.carro || "";
    $("perfilModelo").value = p.modelo || "";
    $("perfilAno").value = p.ano || "";
    $("perfilPlaca").value = p.placa || "";
    $("kmAtual").value = p.kmAtual || "";
}

function salvarPerfil(){
    const p = load("perfilMotorista");
    p.nome = $("perfilNome").value.trim();
    p.carro = $("perfilMarca").value.trim();
    p.modelo = $("perfilModelo").value.trim();
    p.ano = $("perfilAno").value.trim();
    p.placa = $("perfilPlaca").value.trim();
    const km = Number($("kmAtual").value);
    if(km){ p.kmAtual = km; }
    save("perfilMotorista", p);

    // recalc manuten√ß√µes
    const manuts = load("manutencoes");
    manuts.forEach(m => calc(m, p.kmAtual||0));
    save("manutencoes", manuts);

    renderManutencoes();
    alert("Dados salvos!");
}

/* ===================== MANUTEN√á√ïES ====================== */
function calc(m, kmAtual){
    m.kmProxima = Number(m.kmUltimaTroca) + Number(m.intervaloKm);
    m.kmRestante = m.kmProxima - kmAtual;
    m.valorPorKm = (Number(m.custoEstimado)||0) / (Number(m.intervaloKm)||1);
}

function renderManutencoes(){
    const box = $("listaManutencoes");
    box.innerHTML = "";
    const manuts = load("manutencoes");
    const perfil = load("perfilMotorista");
    const kmAtual = Number(perfil.kmAtual||0);

    manuts.forEach(m => calc(m, kmAtual));
    manuts.sort((a,b)=>a.kmRestante - b.kmRestante);
    save("manutencoes", manuts);

    if(!manuts.length){
        box.innerHTML = `<div class='smallNote'>Nenhuma manuten√ß√£o cadastrada</div>`;
        return;
    }

    manuts.forEach(m=>{
        const div = document.createElement("div");
        div.className="listItem";

        const color =
            m.kmRestante <= 800 ? "statusRed" :
            m.kmRestante <= 2000 ? "statusWarn" : "statusGreen";

        div.innerHTML = `
            <div style="flex:1;">
                <div style="font-weight:700;">${esc(m.nome)}</div>
                <div class="smallNote">√öltima: ${m.kmUltimaTroca} ‚Ä¢ Pr√≥x: ${m.kmProxima}</div>
                <div class="smallNote">Custo: ${currency(m.custoEstimado)}</div>
                ${m.obs ? `<div class="smallNote">${esc(m.obs)}</div>` : ""}
            </div>

            <div style="text-align:right;">
                <div class="badge ${color}">${m.kmRestante} km</div>

                <div style="margin-top:8px; display:flex; flex-direction:column; gap:6px;">
                    <button class="btnGhost" onclick="editar(${m.id})">Editar</button>
                    <button class="btnGhost" onclick="remover(${m.id})">Remover</button>
                    <button class="btn" onclick="realizada(${m.id})">Realizar</button>
                </div>
            </div>
        `;
        box.appendChild(div);
    });
}

function adicionar(){
    const nome = $("mNome").value.trim();
    const u = Number($("mKmUltima").value);
    const int = Number($("mIntervalo").value);
    const custo = Number($("mCusto").value);
    const obs = $("mObs").value.trim();

    if(!nome || !u || !int) return alert("Preencha nome, km e intervalo.");

    const perfil = load("perfilMotorista");
    const kmAtual = Number(perfil.kmAtual||0);

    const m = {
        id: Date.now(),
        nome,
        kmUltimaTroca:u,
        intervaloKm:int,
        custoEstimado:custo,
        obs,
        criadoEm:now()
    };

    calc(m, kmAtual);

    const arr = load("manutencoes");
    arr.push(m);
    save("manutencoes", arr);

    renderManutencoes();
    limparFormManut();
}

function editar(id){
    const arr = load("manutencoes");
    const m = arr.find(x=>x.id===id);
    if(!m) return;

    $("mNome").value = m.nome;
    $("mKmUltima").value = m.kmUltimaTroca;
    $("mIntervalo").value = m.intervaloKm;
    $("mCusto").value = m.custoEstimado;
    $("mObs").value = m.obs;

    remover(id);
    window.scrollTo({top:0,behavior:"smooth"});
}

function remover(id){
    if(!confirm("Deseja remover?")) return;
    const arr = load("manutencoes").filter(x=>x.id!==id);
    save("manutencoes", arr);
    renderManutencoes();
}

function realizada(id){
    const arr = load("manutencoes");
    const m = arr.find(x=>x.id === id);
    if(!m) return;

    const perfil = load("perfilMotorista");
    const kmAtual = Number(perfil.kmAtual||0);

    const km = Number(prompt("KM da troca:", kmAtual));
    if(!km) return;

    const valor = Number(prompt("Valor pago:", m.custoEstimado));
    const obs = prompt("Obs:", "") || "";

    const hist = load("manutHistorico");
    hist.push({
        id:Date.now(),
        nome:m.nome,
        kmTroca:km,
        custoPago:valor,
        data:now(),
        obs
    });
    save("manutHistorico", hist);

    m.kmUltimaTroca = km;
    calc(m, kmAtual);
    save("manutencoes", arr);

    if(km > kmAtual){
        perfil.kmAtual = km;
        save("perfilMotorista", perfil);
        renderPerfil();
    }

    renderManutencoes();
    renderHistorico();
    alert("Manuten√ß√£o registrada!");
}

/* ===================== HIST√ìRICO ====================== */
function renderHistorico(){
    const hist = load("manutHistorico");
    const tbody = document.querySelector("#histTable tbody");
    tbody.innerHTML = "";

    if(!hist.length){
        tbody.innerHTML = `<tr><td colspan=5 class='smallNote'>Nenhum registro</td></tr>`;
        return;
    }

    hist.slice().reverse().forEach(h=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${new Date(h.data).toLocaleString()}</td>
            <td>${esc(h.nome)}</td>
            <td>${h.kmTroca}</td>
            <td>${currency(h.custoPago)}</td>
            <td>${esc(h.obs)}</td>
        `;
        tbody.appendChild(tr);
    });
}

/* ===================== EXPORTS ====================== */
function exportWhats(){
    const p = load("perfilMotorista");
    const manuts = load("manutencoes").sort((a,b)=>a.kmRestante-b.kmRestante);

    let msg = `Relat√≥rio de Manuten√ß√£o - ${new Date().toLocaleDateString()}\n\n`;
    msg += `Ve√≠culo: ${p.carro||""} ${p.modelo||""} ‚Ä¢ Placa: ${p.placa||""}\nKM Atual: ${p.kmAtual||0}\n\n`;

    manuts.forEach(m=>{
        msg += `‚Ä¢ ${m.nome}: Pr√≥x ${m.kmProxima} (${m.kmRestante} km)\n`;
    });

    window.open("https://wa.me/?text="+encodeURIComponent(msg),"_blank");
}

async function exportPdf(){
    const el = document.querySelector(".container");
    const canvas = await html2canvas(el,{scale:2});
    const img = canvas.toDataURL("image/png");
    const pdf = new jspdf.jsPDF("p","mm","a4");
    const w = pdf.internal.pageSize.getWidth();
    const h = canvas.height * (w / canvas.width);
    pdf.addImage(img,"PNG",0,0,w,h);
    pdf.save("manutencao.pdf");
}

/* ===================== UTIL ====================== */
function limparFormManut(){
    $("mNome").value="";
    $("mKmUltima").value="";
    $("mIntervalo").value="";
    $("mCusto").value="";
    $("mObs").value="";
}

/* ===================== BOOT ====================== */
renderPerfil();
renderManutencoes();
renderHistorico();

/* EVENTOS */
$("salvarPerfil").onclick = salvarPerfil;
$("limparPerfil").onclick = ()=>{renderPerfil();renderManutencoes();renderHistorico();}
$("addManut").onclick = adicionar;
$("limparFormManut").onclick = limparFormManut;
$("exportWhats").onclick = exportWhats;
$("exportPdf").onclick = exportPdf;

</script>
</body>
</html>

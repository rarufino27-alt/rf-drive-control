<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dashboard - Motorista App</title>

<style>
/* PALETA CORPORATIVA */
:root {
    /* CORES MODO CLARO (atual) */
    --bg: #ffffff;
    --page-gap: #f3f5f8;
    --card: #fafbfc;
    --card-strong: #f0f2f5;
    --panel: #ffffff;

    --brand: #0b5bd7;
    --brand-dark: #073f8a;

    --accent-success: #1DB954;
    --accent-danger: #ff3b30;

    --muted: #65707a;
    --text: #0b1115;

    --shadow: 0 6px 16px rgba(13,30,45,0.07);
    --shadow-strong: 0 10px 32px rgba(10,20,30,0.12);

    --radius: 14px;

    /* === MENU PADR√ÉO ENTRADAS === */
    --menu-bg: linear-gradient(135deg,var(--brand),var(--brand-dark));
}

/* ========= MODO ESCURO ========= */
.dark {
    --bg: #0f1115;
    --page-gap: #15171c;

    --card: #181a20;
    --card-strong: #1d1f27;
    --panel: #1b1d25;

    --text: #e5e7eb;
    --muted: #9ca3af;

    --shadow: 0 6px 16px rgba(0,0,0,0.35);
    --shadow-strong: 0 10px 32px rgba(0,0,0,0.45);
}

/* BASE */
*{box-sizing:border-box}
body{
    margin:0;
    font-family: Inter,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,var(--page-gap),var(--bg) 50%);
    color:var(--text);
    padding-bottom:160px;
}

/* HEADER */
header{
    padding:18px 16px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    max-width:980px;
    margin:12px auto;
}
.brand{
    display:flex; align-items:center; gap:12px;
}
.brand .logo{
    width:46px; height:46px;
    border-radius:12px;
    display:flex; align-items:center; justify-content:center;
    font-weight:800; font-size:18px; color:#fff;
    background:linear-gradient(135deg,var(--brand),var(--brand-dark));
    box-shadow:var(--shadow);
}

/* CONTAINER */
.container{ max-width:980px; margin:0 auto; padding:0 16px; }

/* GREETING */
#greeting{ color:var(--muted); margin:6px 0 14px; font-size:15px; }

/* CARD LUCRO */
.card-lucro{
    background:var(--card-strong);
    border-radius:var(--radius);
    padding:24px;
    border:3px solid transparent;
    box-shadow:var(--shadow-strong);
    margin:14px 0 20px;
    transition:.3s;
}
.card-lucro.positivo{
    border-color:var(--accent-success);
    box-shadow:0 0 0 4px rgba(29,185,84,.18), var(--shadow-strong);
}
.card-lucro.negativo{
    border-color:var(--accent-danger);
    box-shadow:0 0 0 4px rgba(255,59,48,.20), var(--shadow-strong);
}
.card-lucro .label{ font-size:14px; color:var(--muted); }
.card-lucro .valor{ font-size:34px; font-weight:900; margin-top:6px; }
.card-lucro .sub{ font-size:13px; color:var(--muted); }

/* CARDS PEQUENOS */
.row{ display:flex; gap:14px; flex-wrap:wrap; }
.card-small{
    flex:1; min-width:200px;
    background:var(--card);
    border-radius:var(--radius);
    padding:18px;
    box-shadow:var(--shadow);
    border:1px solid #e2e7ec;
}
.card-small .title{ font-size:13px; color:var(--muted); }
.card-small .value{ font-size:22px; font-weight:900; color:var(--brand); margin-top:6px; }
.card-small .gastos{ color:var(--accent-danger)!important; }

/* META DI√ÅRIA ‚Äì PAINEL */
.meta-card{
    background:var(--card-strong);
    border-radius:var(--radius);
    padding:22px;
    border:2px solid #d6dae0;
    margin-top:18px;
    box-shadow:var(--shadow-strong);
}

.meta-card h3{
    margin:0 0 12px 0;
    font-size:16px;
    font-weight:800;
}

/* CIRCULO */
.circular{
    width:140px;
    height:140px;
    border-radius:50%;
    background:#fff;
    position:relative;
    overflow:hidden;
    box-shadow:inset 0 0 25px rgba(13,35,68,0.10), var(--shadow);
}

/* C√çRCULO SVG */
.circular svg{
    position:absolute; top:0; left:0; width:100%; height:100%;
}

.circular .label{
    position:absolute; inset:0;
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
}
.circular .pct{ font-size:20px; font-weight:900; color:var(--brand); }

/* BARRAS */
.chartRow{
    display:flex; gap:14px; padding:12px 0;
}
.bar{
    width:82px; min-height:70px;
    background:#e4e8ef;
    border-radius:10px 10px 0 0;
    display:flex; align-items:flex-end; justify-content:center;
}
.bar .inner{
    width:70%; border-radius:8px 8px 0 0;
    color:#fff; padding-bottom:6px;
    font-weight:700;
}

/* PROGRESSO LINEAR */
.progressBar{
    width:100%; height:14px;
    background:#e4e8ee;
    border-radius:10px;
    overflow:hidden;
}
.progressBar .fill{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,var(--brand),var(--brand-dark));
    transition:.6s;
}

/* ALERTA */
.alert{
    margin-top:12px;
    background:#ffe6e6;
    border:1px solid rgba(255,59,48,0.15);
    padding:12px;
    border-radius:10px;
    text-align:center;
    font-weight:800;
    color:var(--accent-danger);
    display:none;
}

/* =====================================================
      MENU INFERIOR ‚Äî PADR√ÉO EXATO DA P√ÅGINA ENTRADAS
===================================================== */
.bottom-menu{
    position:fixed;
    bottom:18px;
    left:50%;
    transform:translateX(-50%);
    width:92%;
    max-width:980px;
    background:var(--menu-bg);
    padding:10px 0;
    border-radius:18px;
    display:flex;
    justify-content:space-around;
    box-shadow:0 12px 30px rgba(11,30,45,0.5);
    z-index:1000;
    border:1px solid rgba(255,255,255,0.2);
}

.bottom-menu .menu-item{
    text-align:center;
    color:#fff;
    text-decoration:none!important;
    font-size:13px;
    font-weight:800;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:4px;
}

.bottom-menu .menu-item .icon{
    font-size:22px;
    margin-bottom:4px;
}

.bottom-menu .menu-item.active{
    opacity:0.9;
    scale:1.06;
}

/* FAB */
.fab{
    position:fixed;
    right:22px; bottom:95px;
    width:60px; height:60px;
    border-radius:16px;
    font-size:32px;
    display:flex; align-items:center; justify-content:center;
    color:#fff;
    background:linear-gradient(135deg,var(--brand),var(--brand-dark));
    box-shadow:0 18px 40px rgba(11,91,215,.25);
    border:4px solid #fff;
}
</style>
</head>

<body>

<header>
    <div class="brand">
        <div class="logo">RF</div>
        <h1>Dashboard</h1>
    </div>
<button id="toggleTheme" 
        style="
            background:var(--card-strong);
            color:var(--text);
            border:1px solid rgba(0,0,0,0.15);
            padding:8px 12px;
            border-radius:10px;
            cursor:pointer;
            font-weight:700;
        ">
    üåô
</button>
</header>

<div class="container">

    <div id="greeting"></div>

    <div id="cardLucro" class="card-lucro">
        <div>
            <div class="label">Lucro Estimado</div>
            <div id="lucroValor" class="valor">R$ 0,00</div>
            <div class="sub">Vis√£o l√≠quida do dia</div>
        </div>
    </div>

    <div class="row">
        <div class="card-small">
            <div class="title">Gastos do Dia</div>
            <div id="gastosDia" class="value gastos">R$ 0,00</div>
        </div>

        <div class="card-small">
            <div class="title">Total Faturado Hoje</div>
            <div id="totalFaturado" class="value">R$ 0,00</div>
        </div>
    </div>

    <!-- META DI√ÅRIA -->
    <div class="meta-card">

        <h3>Acompanhamento - Meta Di√°ria</h3>

        <div style="display:flex; gap:18px; flex-wrap:wrap;">

            <div class="circular" id="circularWrap"></div>

            <div style="flex:1; min-width:220px;">

                <div style="color:var(--muted);">Meta di√°ria</div>
                <div id="labelMetaDia" style="font-size:20px;font-weight:800;margin-top:4px;">R$ 0,00</div>

                <div style="color:var(--muted); margin-top:10px;">Feito hoje</div>
                <div id="feitoHoje" style="font-size:20px;font-weight:800;margin-top:4px;color:var(--brand)">R$ 0,00</div>

                <div style="color:var(--muted); margin-top:10px;">Diferen√ßa</div>
                <div id="diffHoje" style="font-size:20px;font-weight:800;margin-top:4px;">R$ 0,00</div>

                <div style="margin-top:16px;">
                    <div class="progressBar"><div id="linearFill" class="fill"></div></div>
                </div>

            </div>
        </div>

        <div style="margin-top:14px;">
            <div class="chartRow">
                <div class="bar"><div id="barMeta" class="inner"></div></div>
                <div class="bar"><div id="barHoje" class="inner"></div></div>
            </div>
        </div>

        <div id="alertDaily" class="alert">Voc√™ est√° abaixo da meta di√°ria ‚Äî ajuste seu fluxo.</div>
    </div>

</div>

<button class="fab">+</button>

<!-- MENU INFERIOR PADR√ÉO ENTRADAS -->
<nav class="bottom-menu">
    <a href="index.html" class="menu-item active">
        <span class="icon">üè†</span>
        <span>Dashboard</span>
    </a>

    <a href="entradas.html" class="menu-item">
        <span class="icon">üíµ</span>
        <span>Entradas</span>
    </a>

    <a href="manutencao.html" class="menu-item">
        <span class="icon">üõ†Ô∏è</span>
        <span>Manuten√ß√£o</span>
    </a>

    <a href="resumo.html" class="menu-item">
        <span class="icon">üìä</span>
        <span>Resumo</span>
    </a>

    <a href="perfil.html" class="menu-item">
        <span class="icon">üë§</span>
        <span>Perfil</span>
    </a>

    <a href="calculadora.html" class="menu-item">
        <span class="icon">üìü</span>
        <span>Calc</span>
    </a>
</nav>

<script>
/* Helpers */
const $ = id => document.getElementById(id);
const brl = v => Number(v||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

/* Load state */
function loadState(){
    return {
        registros: JSON.parse(localStorage.getItem("entradasSaidas")||"[]"),
        metaObj: JSON.parse(localStorage.getItem("metaMensal")||"{}"),
        recebers: JSON.parse(localStorage.getItem("valoresReceber")||"[]"),
        perfil: JSON.parse(localStorage.getItem("perfilMotorista")||"{}")
    };
}

function isSameDay(s){
    if(!s) return false;
    const d=new Date(s),n=new Date();
    return d.getFullYear()==n.getFullYear() && d.getMonth()==n.getMonth() && d.getDate()==n.getDate();
}

/* Calculadoras */
function somaBruto(reg){return reg.reduce((s,r)=>r.tipo=="entrada"&&isSameDay(r.criadoEm)?s+Number(r.valorBruto||0):s,0);}
function somaLiq(reg){return reg.reduce((s,r)=>r.tipo=="entrada"&&isSameDay(r.criadoEm)?s+Number(r.valor||0):s,0);}
function somaSaidas(reg){return reg.reduce((s,r)=>r.tipo=="saida"&&isSameDay(r.criadoEm)?s+Number(r.valor||0):s,0);}

function totalReceberMes(arr){
    const n=new Date();
    return arr.reduce((s,r)=>{
        if(!r.data) return s;
        const d=new Date(r.data);
        return (d.getFullYear()==n.getFullYear() && d.getMonth()==n.getMonth()) ? s+Number(r.valor||0) : s;
    },0);
}

function diasRestantes(){
    const h=new Date();
    const u=new Date(h.getFullYear(),h.getMonth()+1,0).getDate();
    return u-h.getDate()+1;
}

function metaDia(meta,receber){
    const mensal=Number(meta.valor||0);
    const rec=totalReceberMes(receber);
    const rest=mensal-rec;
    return rest/diasRestantes();
}

/* Criar c√≠rculo */
function renderCircle(pct){
    const size=140, stroke=12, radius=(size-stroke)/2;
    const circ=2*Math.PI*radius;
    const offset=circ*(1-(pct/100));

    const svg=`
    <svg viewBox="0 0 ${size} ${size}">
        <defs>
            <linearGradient id="grad" x1="0" y1="0" x2="1" y2="0">
                <stop offset="0%" stop-color="${getComputedStyle(document.documentElement).getPropertyValue("--brand").trim()}"/>
                <stop offset="100%" stop-color="${getComputedStyle(document.documentElement).getPropertyValue("--brand-dark").trim()}"/>
            </linearGradient>
        </defs>
        <circle cx="${size/2}" cy="${size/2}" r="${radius}" stroke="#e2e7ec" stroke-width="${stroke}" fill="none"/>
        <circle cx="${size/2}" cy="${size/2}" r="${radius}" 
            stroke="url(#grad)" stroke-width="${stroke}" stroke-linecap="round"
            stroke-dasharray="${circ}" stroke-dashoffset="${offset}"
            style="transition:.6s"/>
    </svg>`;

    $("circularWrap").innerHTML =
        svg +
        `<div class="label">
            <div class="pct">${pct}%</div>
            <div style="font-size:12px;color:var(--muted)">da meta</div>
        </div>`;
}

/* Atualizar dashboard */
function updateDashboard(){
    const {registros,metaObj,recebers,perfil}=loadState();

    /* Nome */
    $("greeting").innerText = "Ol√°, " + (perfil.nome ? perfil.nome.split(" ")[0] : "Motorista") + "!";

    /* Valores */
    const bruto = somaBruto(registros);
    const liquido = somaLiq(registros);
    const gastos = somaSaidas(registros);
    const lucro = bruto - gastos;

    $("gastosDia").innerText = brl(gastos);
    $("totalFaturado").innerText = brl(bruto);
    $("lucroValor").innerText = brl(lucro);

    /* Destaque lucro */
    const card = $("cardLucro");
    card.classList.remove("positivo","negativo");

    if(lucro > 0){
        $("lucroValor").style.color = "var(--accent-success)";
        card.classList.add("positivo");
    } else if(lucro < 0){
        $("lucroValor").style.color = "var(--accent-danger)";
        card.classList.add("negativo");
    } else {
        $("lucroValor").style.color = "var(--text)";
    }

    /* Meta */
    const meta = metaDia(metaObj, recebers);
    const feito = liquido - gastos;
    const diff = feito - meta;
    const pct = meta>0 ? Math.min(100, Math.round((feito/meta)*100)) : 0;

    $("labelMetaDia").innerText = brl(meta);
    $("feitoHoje").innerText = brl(feito);
    $("diffHoje").innerText = brl(diff);

    renderCircle(pct);

    $("linearFill").style.width = pct+"%";

    /* Mini barras */
    const max = Math.max(Math.abs(meta),Math.abs(feito),1);
    $("barMeta").style.height = Math.round(Math.abs(meta)/max*100)+"%";
    $("barHoje").style.height = Math.round(Math.abs(feito)/max*100)+"%";

    $("barMeta").style.background = "linear-gradient(180deg,#e8dca8,#f5ebc4)";
    $("barHoje").style.background = "linear-gradient(180deg,var(--accent-success),#14b64a)";

    $("alertDaily").style.display = feito < meta ? "block" : "none";
}

window.addEventListener("focus", updateDashboard);
updateDashboard();

/* FAB */
document.querySelector(".fab").onclick = ()=> location.href="entradas.html";
</script>

<script>
/* ================================
   TEMA GLOBAL (CLARO / ESCURO)
================================ */
function applyTheme(theme){
    if(theme === "dark"){
        document.documentElement.classList.add("dark");
        localStorage.setItem("theme","dark");
        document.getElementById("toggleTheme").innerText = "‚òÄÔ∏è";
    } else {
        document.documentElement.classList.remove("dark");
        localStorage.setItem("theme","light");
        document.getElementById("toggleTheme").innerText = "üåô";
    }
}

/* Carrega tema salvo */
const savedTheme = localStorage.getItem("theme") || "light";
applyTheme(savedTheme);

/* Alterna tema ao clicar */
document.getElementById("toggleTheme").addEventListener("click", ()=>{
    const isDark = document.documentElement.classList.contains("dark");
    applyTheme(isDark ? "light" : "dark");
});
</script>

</body>
</html>
